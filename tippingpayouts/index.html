<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Footy Tipping Payouts</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    section { margin-bottom: 2rem; }
    .payout { margin-bottom: 1rem; border-bottom: 1px solid #ccc; padding-bottom: 0.5rem; }
    .amount { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Footy Tipping Payouts</h1>
  <p>Based on a stake of <span id="stake">4.7 SOL</span> @ <span id="price">â€¦</span> AUD</p>
  <div id="payouts"></div>

  <script>
    const STAKE_SOL = 4.7;
    const PRICE_API = 'https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=aud';
    const XML_PATH   = 'payouts.xml';

    async function getSolPrice() {
      const resp = await fetch(PRICE_API);
      const obj  = await resp.json();
      return obj.solana.aud;
    }

    async function getPayoutsXml() {
      const resp = await fetch(XML_PATH);
      const text = await resp.text();
      return new DOMParser().parseFromString(text, 'application/xml');
    }

    function render(xml, solPrice) {
      // update header
      document.getElementById('price').textContent = solPrice.toFixed(2) + ' AUD';
      document.getElementById('stake').textContent = STAKE_SOL + ' SOL';

      const container = document.getElementById('payouts');
      container.innerHTML = '';  // clear

      // for each payout option in your XML
      xml.querySelectorAll('option').forEach(opt => {
        const name = opt.getAttribute('name') || 'Option';
        const section = document.createElement('section');
        section.innerHTML = `<h2>${name}</h2>`;
        container.appendChild(section);

        // for each tier
        opt.querySelectorAll('tier').forEach(tier => {
          const tierName    = tier.getAttribute('name') || 'Tier';
          // your XML has a <return> value per tier
          const returnRatio = parseFloat(tier.querySelector('return').textContent);
          const totalSol    = STAKE_SOL * returnRatio;
          const totalAUD    = totalSol * solPrice;

          const div = document.createElement('div');
          div.className = 'payout';
          div.innerHTML = `
            <div>Tier: ${tierName}</div>
            <div>Return Ratio: ${returnRatio}</div>
            <div>Payout (SOL): <span class="amount">${totalSol.toFixed(4)}</span></div>
            <div>Value (AUD): <span class="amount">$${totalAUD.toFixed(2)}</span></div>
          `;
          container.appendChild(div);
        });
      });
    }

    async function refresh() {
      try {
        const [price, xml] = await Promise.all([ getSolPrice(), getPayoutsXml() ]);
        render(xml, price);
      } catch (err) {
        console.error('Data load error:', err);
      }
    }

    // initial load + auto-refresh every minute
    refresh();
    setInterval(refresh, 60_000);
  </script>
</body>
</html>
