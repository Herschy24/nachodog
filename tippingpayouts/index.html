<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Footy Tipping Payouts</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .payout { margin-bottom: 1rem; border-bottom: 1px solid #ccc; padding-bottom: 0.5rem; }
    .amount { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Footy Tipping Payouts</h1>
  <p>Based on a stake of <span id="stake">4.7 SOL</span> @ <span id="price">â€¦</span> AUD</p>
  <div id="payouts"></div>

  <script>
    const STAKE_SOL = 4.7;
    // fetch SOL price in AUD instead of USD
    const PRICE_API = 'https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=aud';
    const XML_PATH   = 'payouts.xml';

    async function getSolPrice() {
      const resp = await fetch(PRICE_API);
      const obj  = await resp.json();
      return obj.solana.aud;
    }

    async function getPayoutsXml() {
      const resp = await fetch(XML_PATH);
      const text = await resp.text();
      return new DOMParser().parseFromString(text, 'application/xml');
    }

    function render(payoutsXml, solPrice) {
      document.getElementById('price').textContent = solPrice.toFixed(2) + ' AUD';
      document.getElementById('stake').textContent = STAKE_SOL + ' SOL';

      const container = document.getElementById('payouts');
      container.innerHTML = '';  // clear existing

      // assuming your XML has <payout amount="X" tier="Y"/> nodes
      payoutsXml.querySelectorAll('payout').forEach(node => {
        const tier       = node.getAttribute('tier') || 'Unknown';
        const amountSol  = parseFloat(node.getAttribute('amount'));
        const returnSol  = amountSol * STAKE_SOL;
        const returnAUD  = returnSol * solPrice;

        const div = document.createElement('div');
        div.className = 'payout';
        div.innerHTML = `
          <div>Tier: ${tier}</div>
          <div>Amount (SOL): <span class="amount">${returnSol.toFixed(4)}</span></div>
          <div>Value (AUD): <span class="amount">$${returnAUD.toFixed(2)}</span></div>
        `;
        container.appendChild(div);
      });
    }

    async function refresh() {
      try {
        const [price, xml] = await Promise.all([ getSolPrice(), getPayoutsXml() ]);
        render(xml, price);
      } catch (e) {
        console.error('Error fetching data:', e);
      }
    }

    // initial load
    refresh();
    // update price every minute
    setInterval(refresh, 60_000);
  </script>
</body>
</html>
